<!doctype html>
<!--[if lt IE 7]><html class="no-js lt-ie9 lt-ie8 lt-ie7" lang="en"> <![endif]-->
<!--[if (IE 7)&!(IEMobile)]><html class="no-js lt-ie9 lt-ie8" lang="en"><![endif]-->
<!--[if (IE 8)&!(IEMobile)]><html class="no-js lt-ie9" lang="en"><![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en"><!--<![endif]-->
<head>
<meta charset="utf-8">
<title>Storing Barycentric Coordinates &#8211; Graham Wihlidal</title>
<meta name="description" content="Just about everything you'll need to style in the theme: headings, paragraphs, blockquotes, tables, code blocks, and more.">
<meta name="keywords" content="barycentric, amd, nvidia, fastgs, vbuffer, visibility buffer, gpu, hlsl, spirv, post">

<!-- Twitter Cards -->
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="http://localhost:4000/images/barycentrics.png">

<meta name="twitter:title" content="Storing Barycentric Coordinates">
<meta name="twitter:description" content="Just about everything you'll need to style in the theme: headings, paragraphs, blockquotes, tables, code blocks, and more.">
<meta name="twitter:creator" content="@gwihlidal">

<!-- Open Graph -->
<meta property="og:locale" content="en_US">
<meta property="og:type" content="article">
<meta property="og:title" content="Storing Barycentric Coordinates">
<meta property="og:description" content="Just about everything you'll need to style in the theme: headings, paragraphs, blockquotes, tables, code blocks, and more.">
<meta property="og:url" content="http://localhost:4000/storing-barycentrics/">
<meta property="og:site_name" content="Graham Wihlidal">





<link rel="canonical" href="http://localhost:4000/storing-barycentrics/">
<link href="http://localhost:4000/feed.xml" type="application/atom+xml" rel="alternate" title="Graham Wihlidal Feed">

<!-- http://t.co/dKP3o1e -->
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- For all browsers -->
<link rel="stylesheet" href="http://localhost:4000/assets/css/main.css">
<!-- Webfonts -->
<link href="//fonts.googleapis.com/css?family=Lato:300,400,700,300italic,400italic" rel="stylesheet" type="text/css">

<meta http-equiv="cleartype" content="on">

<!-- Load Modernizr -->
<script src="http://localhost:4000/assets/js/vendor/modernizr-2.6.2.custom.min.js"></script>

<!-- Icons -->
<!-- 16x16 -->
<link rel="shortcut icon" href="http://localhost:4000/favicon.ico">
<!-- 32x32 -->
<link rel="shortcut icon" href="http://localhost:4000/favicon.png">
<!-- 57x57 (precomposed) for iPhone 3GS, pre-2011 iPod Touch and older Android devices -->
<link rel="apple-touch-icon-precomposed" href="http://localhost:4000/images/apple-touch-icon-precomposed.png">
<!-- 72x72 (precomposed) for 1st generation iPad, iPad 2 and iPad mini -->
<link rel="apple-touch-icon-precomposed" sizes="72x72" href="http://localhost:4000/images/apple-touch-icon-72x72-precomposed.png">
<!-- 114x114 (precomposed) for iPhone 4, 4S, 5 and post-2011 iPod Touch -->
<link rel="apple-touch-icon-precomposed" sizes="114x114" href="http://localhost:4000/images/apple-touch-icon-114x114-precomposed.png">
<!-- 144x144 (precomposed) for iPad 3rd and 4th generation -->
<link rel="apple-touch-icon-precomposed" sizes="144x144" href="http://localhost:4000/images/apple-touch-icon-144x144-precomposed.png">



</head>

<body id="post" class="feature">

<!--[if lt IE 9]><div class="upgrade"><strong><a href="http://whatbrowser.org/">Your browser is quite old!</strong> Why not upgrade to a different browser to better enjoy this site?</a></div><![endif]-->
<nav id="dl-menu" class="dl-menuwrapper" role="navigation">
	<button class="dl-trigger">Open Menu</button>
	<ul class="dl-menu">
		<li><a href="http://localhost:4000/">Home</a></li>
		<li>
			<a href="#">About</a>
			<ul class="dl-submenu">
				<li>
					<img src="http://localhost:4000/images/avatar.jpg" alt="Graham Wihlidal photo" class="author-photo">
					<h4>Graham Wihlidal</h4>
					<p>Senior Rendering Engineer II at SEED, Electronic Arts.</p>
				</li>
				<li><a href="http://localhost:4000/about/"><span class="btn btn-inverse">Summary</span></a></li>
				<li>
					<a href="mailto:graham@wihlidal.ca"><i class="fa fa-fw fa-envelope"></i> Email</a>
				</li>
				<li>
					<a href="https://twitter.com/gwihlidal"><i class="fa fa-fw fa-twitter"></i> Twitter</a>
				</li>
				<li>
					<a href="https://facebook.com/gwihlidal"><i class="fa fa-fw fa-facebook"></i> Facebook</a>
				</li>
				
				<li>
					<a href="https://linkedin.com/in/gwihlidal"><i class="fa fa-fw fa-linkedin"></i> LinkedIn</a>
				</li>
				<li>
					<a href="https://github.com/gwihlidal"><i class="fa fa-fw fa-github"></i> GitHub</a>
				</li>
				
				
				
				
			</ul><!-- /.dl-submenu -->
		</li>
		<li><a href="http://localhost:4000/resume/">Résumé</a></li>
		<li>
			<a href="#">Posts</a>
			<ul class="dl-submenu">
				<li><a href="http://localhost:4000/posts/">All Posts</a></li>
				<li><a href="http://localhost:4000/tags/">All Tags</a></li>
			</ul>
		</li>
		
	    
	    <li><a href="http://localhost:4000/theme-setup/" >Theme Setup</a></li>
	  
	    
	    <li><a href="http://www.wihlidal.ca" target="_blank">External Link</a></li>
	  
	</ul><!-- /.dl-menu -->
</nav><!-- /.dl-menuwrapper -->



<div class="entry-header">
  
  <div class="entry-image">
    <img src="http://localhost:4000/images/barycentrics.png" alt="Storing Barycentric Coordinates">
  </div><!-- /.entry-image -->
</div><!-- /.entry-header -->


<div id="main" role="main">
  <article class="hentry">
    <header class="header-title">
      <div class="header-title-wrap">
        
          <h1 class="entry-title"><a href="http://localhost:4000/storing-barycentrics/" rel="bookmark" title="Storing Barycentric Coordinates">Storing Barycentric Coordinates</a></h1>
        
        <h2><span class="entry-date date published"><time datetime="2017-11-26T00:00:00-05:00">November 26, 2017</time></span></h2>
        
        <p class="entry-reading-time">
          <i class="fa fa-clock-o"></i>
          
Reading time ~6 minutes
        </p><!-- /.entry-reading-time -->
        
      </div><!-- /.header-title-wrap -->
    </header>
    <div class="entry-content">
      <p>Using a visibility buffer (vbuffer) to accelerate sample shading has been a very interesting topic since the original technique was presented.<sup id="fnref:1"><a href="#fn:1" class="footnote">1</a></sup></p>

<p>The general idea behind a vbuffer is..X</p>

<p>Lorem ipsum dolor sit amet, test link adipiscing elit. <strong>This is strong</strong>. Nullam dignissim convallis est. Quisque aliquam.</p>

<p class="image-right"><img src="http://localhost:4000/images/3953273590_704e3899d5_m.jpg" alt="Smithsonian Image" /></p>

<p><em>This is emphasized</em>. Donec faucibus. Nunc iaculis suscipit dui. 53 = 125. Water is H<sub>2</sub>O. Nam sit amet sem. Aliquam libero nisi, imperdiet at, tincidunt nec, gravida vehicula, nisl. The New York Times <cite>(That’s a citation)</cite>. <u>Underline</u>. Maecenas ornare tortor. Donec sed tellus eget sapien fringilla nonummy. Mauris a ante. Suspendisse quam sem, consequat at, commodo vitae, feugiat in, nunc. Morbi imperdiet augue quis tellus.</p>

<p>HTML and <abbr title="cascading stylesheets">CSS<abbr> are our tools. Mauris a ante. Suspendisse quam sem, consequat at, commodo vitae, feugiat in, nunc. Morbi imperdiet augue quis tellus. Praesent mattis, massa quis luctus fermentum, turpis mi volutpat justo, eu volutpat enim diam eget metus.</abbr></abbr></p>

<h3 id="blockquotes">Blockquotes</h3>

<blockquote>
  <p>Lorem ipsum dolor sit amet, test link adipiscing elit. Nullam dignissim convallis est. Quisque aliquam.</p>
</blockquote>

<h2 id="list-types">List Types</h2>

<h3 id="ordered-lists">Ordered Lists</h3>

<ol>
  <li>Item one
    <ol>
      <li>sub item one</li>
      <li>sub item two</li>
      <li>sub item three</li>
    </ol>
  </li>
  <li>Item two</li>
</ol>

<h3 id="unordered-lists">Unordered Lists</h3>

<ul>
  <li>Item one</li>
  <li>Item two</li>
  <li>Item three</li>
</ul>

<h2 id="tables">Tables</h2>

<table rules="groups">
  <thead>
    <tr>
      <th style="text-align: left">Header1</th>
      <th style="text-align: center">Header2</th>
      <th style="text-align: right">Header3</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: left">cell1</td>
      <td style="text-align: center">cell2</td>
      <td style="text-align: right">cell3</td>
    </tr>
    <tr>
      <td style="text-align: left">cell4</td>
      <td style="text-align: center">cell5</td>
      <td style="text-align: right">cell6</td>
    </tr>
  </tbody>
  <tbody>
    <tr>
      <td style="text-align: left">cell1</td>
      <td style="text-align: center">cell2</td>
      <td style="text-align: right">cell3</td>
    </tr>
    <tr>
      <td style="text-align: left">cell4</td>
      <td style="text-align: center">cell5</td>
      <td style="text-align: right">cell6</td>
    </tr>
  </tbody>
  <tfoot>
    <tr>
      <td style="text-align: left">Foot1</td>
      <td style="text-align: center">Foot2</td>
      <td style="text-align: right">Foot3</td>
    </tr>
  </tfoot>
</table>

<h2 id="code-snippets">Code Snippets</h2>

<p>Generic Geometry Shader:</p>
<div class="language-glsl highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#version 450
</span>
<span class="cp">#extension GL_ARB_separate_shader_objects : enable
#extension GL_ARB_shading_language_420pack : enable
#extension GL_ARB_shader_image_load_store : enable
</span>
<span class="k">layout</span><span class="p">(</span><span class="n">triangles</span><span class="p">)</span> <span class="k">in</span><span class="p">;</span>
<span class="k">layout</span><span class="p">(</span><span class="n">triangle_strip</span><span class="p">,</span> <span class="n">max_vertices</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span> <span class="k">out</span><span class="p">;</span>

<span class="k">in</span> <span class="k">layout</span> <span class="p">(</span><span class="n">location</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span> <span class="kt">vec3</span> <span class="n">g_inNormal</span><span class="p">[];</span>
<span class="k">in</span> <span class="k">layout</span> <span class="p">(</span><span class="n">location</span> <span class="o">=</span> <span class="mi">2</span><span class="p">)</span> <span class="kt">vec2</span> <span class="n">g_inTexcoord</span><span class="p">[];</span>

<span class="k">out</span> <span class="k">layout</span> <span class="p">(</span><span class="n">location</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span> <span class="kt">vec2</span> <span class="n">g_outTexcoord</span><span class="p">;</span>
<span class="k">out</span> <span class="k">smooth</span> <span class="k">layout</span> <span class="p">(</span><span class="n">location</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span> <span class="kt">vec3</span> <span class="n">g_outBarycentrics</span><span class="p">;</span>
<span class="k">out</span> <span class="k">layout</span> <span class="p">(</span><span class="n">location</span> <span class="o">=</span> <span class="mi">2</span><span class="p">)</span> <span class="k">flat</span> <span class="kt">uint</span> <span class="n">g_primitiveId</span><span class="p">;</span>
<span class="k">out</span> <span class="k">layout</span> <span class="p">(</span><span class="n">location</span> <span class="o">=</span> <span class="mi">3</span><span class="p">)</span> <span class="k">flat</span> <span class="kt">uint</span> <span class="n">g_drawId</span><span class="p">;</span>

<span class="kt">void</span> <span class="nf">main</span><span class="p">()</span>
<span class="p">{</span>
	<span class="nb">gl_Position</span> <span class="o">=</span> <span class="n">gl_in</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nb">gl_Position</span><span class="p">;</span>
	<span class="n">g_outTexcoord</span> <span class="o">=</span> <span class="n">g_inTexcoord</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
	<span class="n">g_outBarycentrics</span> <span class="o">=</span> <span class="kt">vec3</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
	<span class="n">g_primitiveId</span> <span class="o">=</span> <span class="nb">gl_PrimitiveID</span><span class="p">;</span>
	<span class="n">g_drawId</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="nb">gl_Layer</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="n">EmitVertex</span><span class="p">();</span>

	<span class="nb">gl_Position</span> <span class="o">=</span> <span class="n">gl_in</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="nb">gl_Position</span><span class="p">;</span>
	<span class="n">g_outTexcoord</span> <span class="o">=</span> <span class="n">g_inTexcoord</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
	<span class="n">g_outBarycentrics</span> <span class="o">=</span> <span class="kt">vec3</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
	<span class="n">g_primitiveId</span> <span class="o">=</span> <span class="nb">gl_PrimitiveID</span><span class="p">;</span>
	<span class="n">g_drawId</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="nb">gl_Layer</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="n">EmitVertex</span><span class="p">();</span>

	<span class="nb">gl_Position</span> <span class="o">=</span> <span class="n">gl_in</span><span class="p">[</span><span class="mi">2</span><span class="p">].</span><span class="nb">gl_Position</span><span class="p">;</span>
	<span class="n">g_outTexcoord</span> <span class="o">=</span> <span class="n">g_inTexcoord</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>
	<span class="n">g_outBarycentrics</span> <span class="o">=</span> <span class="kt">vec3</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="n">g_primitiveId</span> <span class="o">=</span> <span class="nb">gl_PrimitiveID</span><span class="p">;</span>
	<span class="n">g_drawId</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="nb">gl_Layer</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="n">EmitVertex</span><span class="p">();</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Generic Pixel Shader:</p>
<div class="language-glsl highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#version 450
</span>
<span class="cp">#extension GL_ARB_separate_shader_objects : enable
#extension GL_ARB_shading_language_420pack : enable
#extension GL_ARB_shader_image_load_store : enable
#extension GL_GOOGLE_include_directive : enable
</span>
<span class="cp">#include "VisibilityCommon.inc"
</span>
<span class="k">layout</span><span class="p">(</span><span class="n">early_fragment_tests</span><span class="p">)</span> <span class="k">in</span><span class="p">;</span>

<span class="k">layout</span> <span class="p">(</span><span class="n">location</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span> <span class="k">in</span> <span class="kt">vec2</span> <span class="n">uv_in</span><span class="p">;</span>
<span class="k">layout</span> <span class="p">(</span><span class="n">location</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span> <span class="k">in</span> <span class="k">smooth</span> <span class="kt">vec3</span> <span class="n">barycentrics_in</span><span class="p">;</span>
<span class="k">layout</span> <span class="p">(</span><span class="n">location</span> <span class="o">=</span> <span class="mi">2</span><span class="p">)</span> <span class="k">in</span> <span class="k">flat</span> <span class="kt">uint</span> <span class="n">primitiveId_in</span><span class="p">;</span>
<span class="k">layout</span> <span class="p">(</span><span class="n">location</span> <span class="o">=</span> <span class="mi">3</span><span class="p">)</span> <span class="k">in</span> <span class="k">flat</span> <span class="kt">uint</span> <span class="n">drawId_in</span><span class="p">;</span>

<span class="c1">// Y = I,J bary coords, K can be calculated
</span><span class="k">layout</span> <span class="p">(</span><span class="n">location</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span> <span class="k">out</span> <span class="kt">uvec2</span> <span class="n">id_and_barys</span><span class="p">;</span>
<span class="c1">// X,Y = dFdX, dFdY
</span><span class="k">layout</span> <span class="p">(</span><span class="n">location</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span> <span class="k">out</span> <span class="kt">uvec2</span> <span class="n">derivs</span><span class="p">;</span>
<span class="k">layout</span> <span class="p">(</span><span class="n">location</span> <span class="o">=</span> <span class="mi">2</span><span class="p">)</span> <span class="k">out</span> <span class="kt">vec4</span> <span class="n">debug_out</span><span class="p">;</span>

<span class="k">layout</span><span class="p">(</span><span class="n">origin_upper_left</span><span class="p">)</span> <span class="k">in</span> <span class="kt">vec4</span> <span class="nb">gl_FragCoord</span><span class="p">;</span>

<span class="kt">void</span> <span class="nf">main</span><span class="p">()</span>
<span class="p">{</span>
	<span class="n">debug_out</span> <span class="o">=</span> <span class="kt">vec4</span><span class="p">(</span><span class="n">barycentrics_in</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>

	<span class="n">id_and_barys</span><span class="p">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">calculateVisibilityId</span><span class="p">(</span><span class="nb">true</span><span class="p">,</span> <span class="n">drawId_in</span><span class="p">,</span> <span class="n">primitiveId_in</span><span class="p">);</span>
	<span class="n">id_and_barys</span><span class="p">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">packUnorm2x16</span><span class="p">(</span><span class="n">debug_out</span><span class="p">.</span><span class="n">xy</span><span class="p">);</span>

	<span class="n">derivs</span><span class="p">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">packSnorm2x16</span><span class="p">(</span><span class="n">dFdx</span><span class="p">(</span><span class="n">uv_in</span><span class="p">));</span>
	<span class="n">derivs</span><span class="p">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">packSnorm2x16</span><span class="p">(</span><span class="n">dFdy</span><span class="p">(</span><span class="n">uv_in</span><span class="p">));</span>
<span class="p">}</span>
</code></pre></div></div>

<p>AMD Vertex Shader:</p>
<div class="language-glsl highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#version 450
</span>
<span class="cp">#extension GL_ARB_separate_shader_objects : enable
#extension GL_ARB_shading_language_420pack : enable
#extension GL_ARB_shader_draw_parameters : enable
</span>
<span class="cp">#define kProjViewMatricesBindingPos 0
#define kModelMatricesBindingPos 0
</span>
<span class="k">layout</span> <span class="p">(</span><span class="n">location</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span> <span class="k">in</span> <span class="kt">vec3</span> <span class="n">pos</span><span class="p">;</span>
<span class="k">layout</span> <span class="p">(</span><span class="n">location</span> <span class="o">=</span> <span class="mi">2</span><span class="p">)</span> <span class="k">in</span> <span class="kt">vec2</span> <span class="n">uv_in</span><span class="p">;</span>

<span class="k">layout</span> <span class="p">(</span><span class="n">location</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span> <span class="k">flat</span> <span class="k">out</span> <span class="kt">uint</span> <span class="n">draw_id</span><span class="p">;</span>
<span class="k">layout</span> <span class="p">(</span><span class="n">location</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span> <span class="k">out</span> <span class="kt">vec2</span> <span class="n">uv_out</span><span class="p">;</span>
<span class="k">layout</span> <span class="p">(</span><span class="n">location</span> <span class="o">=</span> <span class="mi">2</span><span class="p">)</span> <span class="k">flat</span> <span class="k">out</span> <span class="kt">vec4</span> <span class="n">pos0</span><span class="p">;</span>
<span class="k">layout</span> <span class="p">(</span><span class="n">location</span> <span class="o">=</span> <span class="mi">3</span><span class="p">)</span>      <span class="k">out</span> <span class="kt">vec4</span> <span class="n">pos1</span><span class="p">;</span>

<span class="k">layout</span> <span class="p">(</span><span class="n">constant_id</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span> <span class="k">const</span> <span class="kt">uint</span> <span class="n">num_materials</span> <span class="o">=</span> <span class="mi">1U</span><span class="p">;</span>
<span class="k">layout</span> <span class="p">(</span><span class="n">constant_id</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span> <span class="k">const</span> <span class="kt">uint</span> <span class="n">num_lights</span> <span class="o">=</span> <span class="mi">1U</span><span class="p">;</span>

<span class="k">struct</span> <span class="n">Light</span>
<span class="p">{</span>
	<span class="kt">vec4</span> <span class="n">pos_radius</span><span class="p">;</span>
	<span class="kt">vec4</span> <span class="n">diff_colour</span><span class="p">;</span>
	<span class="kt">vec4</span> <span class="n">spec_colour</span><span class="p">;</span>
<span class="p">};</span>

<span class="c1">// Could be packed better but it's kept like this until optimisation stage
</span><span class="k">struct</span> <span class="n">MatConsts</span>
<span class="p">{</span>
	<span class="kt">vec4</span> <span class="n">diffuse_dissolve</span><span class="p">;</span>
	<span class="kt">vec4</span> <span class="n">specular_shininess</span><span class="p">;</span>
	<span class="kt">vec3</span> <span class="n">ambient</span><span class="p">;</span>
	<span class="cm">/* 32-bit padding goes here on host side, but GLSL will transform
		the ambient vec3 into a vec4 */</span>
	<span class="kt">vec3</span> <span class="n">emission</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">layout</span> <span class="p">(</span><span class="n">std430</span><span class="p">,</span> <span class="n">set</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">binding</span> <span class="o">=</span> <span class="n">kProjViewMatricesBindingPos</span><span class="p">)</span> <span class="n">buffer</span> <span class="n">MainStaticBuffer</span>
<span class="p">{</span>
	<span class="kt">mat4</span> <span class="n">proj</span><span class="p">;</span>
	<span class="kt">mat4</span> <span class="n">view</span><span class="p">;</span>
	<span class="kt">mat4</span> <span class="n">inv_proj</span><span class="p">;</span>
	<span class="kt">mat4</span> <span class="n">inv_view</span><span class="p">;</span>
	<span class="n">Light</span> <span class="n">lights</span><span class="p">[</span><span class="n">num_lights</span><span class="p">];</span>
	<span class="n">MatConsts</span> <span class="n">mat_consts</span><span class="p">[</span><span class="n">num_materials</span><span class="p">];</span>
<span class="p">};</span>

<span class="k">layout</span> <span class="p">(</span><span class="n">std430</span><span class="p">,</span> <span class="n">set</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">binding</span> <span class="o">=</span> <span class="n">kModelMatricesBindingPos</span><span class="p">)</span> <span class="n">buffer</span> <span class="n">ModelMats</span>
<span class="p">{</span>
	<span class="kt">mat4</span> <span class="n">model_mats</span><span class="p">[];</span>
<span class="p">};</span>

<span class="k">layout</span><span class="p">(</span><span class="n">push_constant</span><span class="p">)</span> <span class="k">uniform</span> <span class="n">PushConsts</span>
<span class="p">{</span>
	<span class="kt">uint</span> <span class="n">val</span><span class="p">;</span>
<span class="p">}</span>
<span class="n">mesh_id</span><span class="p">;</span>

<span class="kt">void</span> <span class="nf">main</span><span class="p">()</span>
<span class="p">{</span>
	<span class="n">draw_id</span> <span class="o">=</span> <span class="n">mesh_id</span><span class="p">.</span><span class="n">val</span><span class="p">;</span>
	<span class="n">uv_out</span> <span class="o">=</span> <span class="n">uv_in</span><span class="p">;</span>
	<span class="kt">vec4</span> <span class="n">temp</span> <span class="o">=</span> <span class="n">proj</span> <span class="o">*</span> <span class="n">view</span> <span class="o">*</span> <span class="n">model_mats</span><span class="p">[</span><span class="n">draw_id</span><span class="p">]</span> <span class="o">*</span> <span class="kt">vec4</span><span class="p">(</span><span class="n">pos</span><span class="p">,</span> <span class="mi">1</span><span class="p">.</span><span class="n">f</span><span class="p">);</span>
	<span class="n">pos0</span> <span class="o">=</span> <span class="n">temp</span><span class="p">;</span>
	<span class="n">pos1</span> <span class="o">=</span> <span class="n">temp</span><span class="p">;</span>
	<span class="nb">gl_Position</span> <span class="o">=</span> <span class="n">temp</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<p>AMD Intrinsics Pixel Shader:<sup id="fnref:2"><a href="#fn:2" class="footnote">2</a></sup></p>
<div class="language-glsl highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#version 450
</span>
<span class="cp">#extension GL_ARB_separate_shader_objects : enable
#extension GL_ARB_shading_language_420pack : enable
#extension GL_AMD_shader_explicit_vertex_parameter : enable
#extension GL_ARB_shader_image_load_store : enable
#extension GL_GOOGLE_include_directive : enable
</span>
<span class="cp">#include "VisibilityCommon.inc"
</span>
<span class="k">layout</span><span class="p">(</span><span class="n">early_fragment_tests</span><span class="p">)</span> <span class="k">in</span><span class="p">;</span>

<span class="k">layout</span> <span class="p">(</span><span class="n">location</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span> <span class="k">flat</span> <span class="k">in</span> <span class="kt">uint</span> <span class="n">draw_id</span><span class="p">;</span>
<span class="k">layout</span> <span class="p">(</span><span class="n">location</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span> <span class="k">in</span> <span class="kt">vec2</span> <span class="n">uv_in</span><span class="p">;</span>
<span class="k">layout</span> <span class="p">(</span><span class="n">location</span> <span class="o">=</span> <span class="mi">2</span><span class="p">)</span> <span class="k">flat</span> <span class="k">in</span> <span class="kt">vec4</span> <span class="n">pos0</span><span class="p">;</span>
<span class="k">layout</span> <span class="p">(</span><span class="n">location</span> <span class="o">=</span> <span class="mi">3</span><span class="p">)</span> <span class="n">__explicitInterpAMD</span> <span class="k">in</span> <span class="kt">vec4</span> <span class="n">pos1</span><span class="p">;</span>

<span class="c1">// Y = I,J bary coords, K can be calculated
</span><span class="k">layout</span> <span class="p">(</span><span class="n">location</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span> <span class="k">out</span> <span class="kt">uvec2</span> <span class="n">id_and_barys</span><span class="p">;</span>
<span class="c1">// X,Y = dFdX, dFdY
</span><span class="k">layout</span> <span class="p">(</span><span class="n">location</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span> <span class="k">out</span> <span class="kt">uvec2</span> <span class="n">derivs</span><span class="p">;</span>
<span class="k">layout</span> <span class="p">(</span><span class="n">location</span> <span class="o">=</span> <span class="mi">2</span><span class="p">)</span> <span class="k">out</span> <span class="kt">vec4</span> <span class="n">debug_out</span><span class="p">;</span>

<span class="kt">void</span> <span class="nf">main</span><span class="p">()</span>
<span class="p">{</span>
	<span class="n">id_and_barys</span><span class="p">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">calculateVisibilityId</span><span class="p">(</span><span class="nb">true</span><span class="p">,</span> <span class="n">draw_id</span><span class="p">,</span> <span class="nb">gl_PrimitiveID</span><span class="p">);</span>

	<span class="kt">vec4</span> <span class="n">v0</span> <span class="o">=</span> <span class="n">interpolateAtVertexAMD</span><span class="p">(</span><span class="n">pos1</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
	<span class="kt">vec4</span> <span class="n">v1</span> <span class="o">=</span> <span class="n">interpolateAtVertexAMD</span><span class="p">(</span><span class="n">pos1</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="kt">vec4</span> <span class="n">v2</span> <span class="o">=</span> <span class="n">interpolateAtVertexAMD</span><span class="p">(</span><span class="n">pos1</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">v0</span> <span class="o">==</span> <span class="n">pos0</span><span class="p">)</span>
	<span class="p">{</span>
		<span class="n">debug_out</span><span class="p">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">gl_BaryCoordSmoothAMD</span><span class="p">.</span><span class="n">x</span><span class="p">;</span>
		<span class="n">debug_out</span><span class="p">.</span><span class="n">z</span> <span class="o">=</span> <span class="n">gl_BaryCoordSmoothAMD</span><span class="p">.</span><span class="n">y</span><span class="p">;</span>
		<span class="n">debug_out</span><span class="p">.</span><span class="n">x</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">debug_out</span><span class="p">.</span><span class="n">z</span> <span class="o">-</span> <span class="n">debug_out</span><span class="p">.</span><span class="n">y</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">v1</span> <span class="o">==</span> <span class="n">pos0</span><span class="p">)</span>
	<span class="p">{</span>
		<span class="n">debug_out</span><span class="p">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">gl_BaryCoordSmoothAMD</span><span class="p">.</span><span class="n">x</span><span class="p">;</span>
		<span class="n">debug_out</span><span class="p">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">gl_BaryCoordSmoothAMD</span><span class="p">.</span><span class="n">y</span><span class="p">;</span>
		<span class="n">debug_out</span><span class="p">.</span><span class="n">z</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">debug_out</span><span class="p">.</span><span class="n">x</span> <span class="o">-</span> <span class="n">debug_out</span><span class="p">.</span><span class="n">y</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">v2</span> <span class="o">==</span> <span class="n">pos0</span><span class="p">)</span>
	<span class="p">{</span>
		<span class="n">debug_out</span><span class="p">.</span><span class="n">z</span> <span class="o">=</span> <span class="n">gl_BaryCoordSmoothAMD</span><span class="p">.</span><span class="n">x</span><span class="p">;</span>
		<span class="n">debug_out</span><span class="p">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">gl_BaryCoordSmoothAMD</span><span class="p">.</span><span class="n">y</span><span class="p">;</span>
		<span class="n">debug_out</span><span class="p">.</span><span class="n">y</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">debug_out</span><span class="p">.</span><span class="n">x</span> <span class="o">-</span> <span class="n">debug_out</span><span class="p">.</span><span class="n">z</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="n">derivs</span><span class="p">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">packSnorm2x16</span><span class="p">(</span><span class="n">dFdx</span><span class="p">(</span><span class="n">uv_in</span><span class="p">));</span>
	<span class="n">derivs</span><span class="p">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">packSnorm2x16</span><span class="p">(</span><span class="n">dFdy</span><span class="p">(</span><span class="n">uv_in</span><span class="p">));</span>
	<span class="n">id_and_barys</span><span class="p">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">packUnorm2x16</span><span class="p">(</span><span class="n">debug_out</span><span class="p">.</span><span class="n">xy</span><span class="p">);</span>

	<span class="n">debug_out</span><span class="p">.</span><span class="n">z</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<p>NV FastGS Geometry Shader:</p>
<div class="language-glsl highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// https://www.khronos.org/registry/OpenGL/extensions/NV/NV_geometry_shader_passthrough.txt
</span>
<span class="cp">#version 450
</span>
<span class="cp">#extension GL_ARB_separate_shader_objects : enable
#extension GL_ARB_shading_language_420pack : enable
#extension GL_ARB_shader_image_load_store : enable
#extension GL_NV_geometry_shader_passthrough : require
</span>
<span class="k">layout</span> <span class="p">(</span><span class="n">push_constant</span><span class="p">)</span> <span class="k">uniform</span> <span class="n">PushConstants</span>
<span class="p">{</span>
	<span class="kt">float</span> <span class="n">halfViewWidth</span><span class="p">;</span>
	<span class="kt">float</span> <span class="n">halfViewHeight</span><span class="p">;</span>
<span class="p">}</span>
<span class="n">g_pcs</span><span class="p">;</span>

<span class="k">layout</span><span class="p">(</span><span class="n">triangles</span><span class="p">)</span> <span class="k">in</span><span class="p">;</span>

<span class="k">layout</span><span class="p">(</span><span class="n">passthrough</span><span class="p">)</span> <span class="k">in</span> <span class="nb">gl_PerVertex</span>
<span class="p">{</span>
	<span class="kt">vec4</span> <span class="nb">gl_Position</span><span class="p">;</span>
<span class="p">}</span>
<span class="n">gl_in</span><span class="p">[];</span>

<span class="k">in</span> <span class="k">layout</span> <span class="p">(</span><span class="n">location</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">passthrough</span><span class="p">)</span> <span class="kt">vec3</span> <span class="n">g_inPosition</span><span class="p">[];</span>
<span class="k">in</span> <span class="k">layout</span> <span class="p">(</span><span class="n">location</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">passthrough</span><span class="p">)</span> <span class="kt">vec3</span> <span class="n">g_inNormal</span><span class="p">[];</span>
<span class="k">in</span> <span class="k">layout</span> <span class="p">(</span><span class="n">location</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span> <span class="n">passthrough</span><span class="p">)</span> <span class="kt">vec2</span> <span class="n">g_inTexcoord</span><span class="p">[];</span>

<span class="k">out</span> <span class="k">layout</span> <span class="p">(</span><span class="n">location</span> <span class="o">=</span> <span class="mi">3</span><span class="p">)</span> <span class="kt">vec4</span> <span class="n">g_planeEquationBx</span><span class="p">;</span>
<span class="k">out</span> <span class="k">layout</span> <span class="p">(</span><span class="n">location</span> <span class="o">=</span> <span class="mi">4</span><span class="p">)</span> <span class="kt">vec4</span> <span class="n">g_planeEquationBy</span><span class="p">;</span>
<span class="k">out</span> <span class="k">layout</span> <span class="p">(</span><span class="n">location</span> <span class="o">=</span> <span class="mi">5</span><span class="p">)</span> <span class="k">flat</span> <span class="kt">uint</span> <span class="n">g_primitiveId</span><span class="p">;</span>
<span class="k">out</span> <span class="k">layout</span> <span class="p">(</span><span class="n">location</span> <span class="o">=</span> <span class="mi">6</span><span class="p">)</span> <span class="k">flat</span> <span class="kt">uint</span> <span class="n">g_drawId</span><span class="p">;</span>

<span class="c1">// Standard plane equation from three points.
</span><span class="kt">vec4</span> <span class="nf">planeEquation</span><span class="p">(</span><span class="kt">vec3</span> <span class="n">p0</span><span class="p">,</span> <span class="kt">vec3</span> <span class="n">p1</span><span class="p">,</span> <span class="kt">vec3</span> <span class="n">p2</span><span class="p">)</span>
<span class="p">{</span>
	<span class="c1">// Using a standard plane eqn derivation for the barycentrics is potentially inefficient because the z coords are
</span>	<span class="c1">// all 0 or 1.  But, IMO this is more comprehensible than expanding out the terms.
</span>	<span class="k">const</span> <span class="kt">vec3</span> <span class="n">v01</span> <span class="o">=</span> <span class="n">p1</span> <span class="o">-</span> <span class="n">p0</span><span class="p">;</span>
	<span class="k">const</span> <span class="kt">vec3</span> <span class="n">v12</span> <span class="o">=</span> <span class="n">p2</span> <span class="o">-</span> <span class="n">p1</span><span class="p">;</span>
	<span class="k">const</span> <span class="kt">vec3</span> <span class="n">n</span>   <span class="o">=</span> <span class="n">cross</span><span class="p">(</span><span class="n">v01</span><span class="p">,</span> <span class="n">v12</span><span class="p">);</span>
	<span class="k">const</span> <span class="kt">float</span> <span class="n">d</span>  <span class="o">=</span> <span class="o">-</span><span class="n">dot</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">p0</span><span class="p">);</span>
	<span class="k">return</span> <span class="kt">vec4</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">d</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">vec2</span> <span class="nf">viewportTransform</span><span class="p">(</span><span class="kt">vec4</span> <span class="n">p</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">float</span> <span class="n">x</span> <span class="o">=</span> <span class="p">(</span><span class="n">p</span><span class="p">.</span><span class="n">x</span> <span class="o">/</span> <span class="n">p</span><span class="p">.</span><span class="n">w</span><span class="p">)</span> <span class="o">*</span> <span class="n">g_pcs</span><span class="p">.</span><span class="n">halfViewWidth</span>  <span class="o">+</span> <span class="n">g_pcs</span><span class="p">.</span><span class="n">halfViewWidth</span><span class="p">;</span>
	<span class="kt">float</span> <span class="n">y</span> <span class="o">=</span> <span class="p">(</span><span class="n">p</span><span class="p">.</span><span class="n">y</span> <span class="o">/</span> <span class="n">p</span><span class="p">.</span><span class="n">w</span><span class="p">)</span> <span class="o">*</span> <span class="n">g_pcs</span><span class="p">.</span><span class="n">halfViewHeight</span> <span class="o">+</span> <span class="n">g_pcs</span><span class="p">.</span><span class="n">halfViewHeight</span><span class="p">;</span>
	<span class="k">return</span> <span class="kt">vec2</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">computeBarycentricPlaneEquations</span><span class="p">(</span>
	<span class="k">in</span> <span class="kt">vec4</span> <span class="n">proj0</span><span class="p">,</span> <span class="k">in</span> <span class="kt">vec4</span> <span class="n">proj1</span><span class="p">,</span> <span class="k">in</span> <span class="kt">vec4</span> <span class="n">proj2</span><span class="p">,</span>
	<span class="k">out</span> <span class="kt">vec4</span> <span class="n">planeEquationBx</span><span class="p">,</span> <span class="k">out</span> <span class="kt">vec4</span> <span class="n">planeEquationBy</span><span class="p">)</span>
<span class="p">{</span>
	<span class="c1">// Construct planes in (x,y,b) space where x and y are screen-space position and b is one of the
</span>	<span class="c1">// barycentric coords.  We need one per barycentric coord.
</span>	<span class="kt">vec2</span> <span class="n">screen0</span> <span class="o">=</span> <span class="n">viewportTransform</span><span class="p">(</span><span class="n">proj0</span><span class="p">);</span>
	<span class="kt">vec2</span> <span class="n">screen1</span> <span class="o">=</span> <span class="n">viewportTransform</span><span class="p">(</span><span class="n">proj1</span><span class="p">);</span>
	<span class="kt">vec2</span> <span class="n">screen2</span> <span class="o">=</span> <span class="n">viewportTransform</span><span class="p">(</span><span class="n">proj2</span><span class="p">);</span>
	<span class="n">planeEquationBx</span> <span class="o">=</span> <span class="n">planeEquation</span><span class="p">(</span><span class="kt">vec3</span><span class="p">(</span><span class="n">screen0</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="kt">vec3</span><span class="p">(</span><span class="n">screen1</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="kt">vec3</span><span class="p">(</span><span class="n">screen2</span><span class="p">,</span> <span class="mi">0</span><span class="p">));</span>
	<span class="n">planeEquationBy</span> <span class="o">=</span> <span class="n">planeEquation</span><span class="p">(</span><span class="kt">vec3</span><span class="p">(</span><span class="n">screen0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="kt">vec3</span><span class="p">(</span><span class="n">screen1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="kt">vec3</span><span class="p">(</span><span class="n">screen2</span><span class="p">,</span> <span class="mi">0</span><span class="p">));</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">main</span><span class="p">()</span>
<span class="p">{</span>
	<span class="nb">gl_Layer</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

	<span class="n">g_primitiveId</span> <span class="o">=</span> <span class="nb">gl_PrimitiveID</span><span class="p">;</span>
	<span class="n">g_drawId</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

	<span class="n">computeBarycentricPlaneEquations</span><span class="p">(</span>
		<span class="n">gl_in</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nb">gl_Position</span><span class="p">,</span> <span class="n">gl_in</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="nb">gl_Position</span><span class="p">,</span> <span class="n">gl_in</span><span class="p">[</span><span class="mi">2</span><span class="p">].</span><span class="nb">gl_Position</span><span class="p">,</span>
		<span class="n">g_planeEquationBx</span><span class="p">,</span> <span class="n">g_planeEquationBy</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Pass-through Pixel Shader:</p>

<div class="language-glsl highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#version 450
</span>
<span class="cp">#extension GL_ARB_separate_shader_objects : enable
#extension GL_ARB_shading_language_420pack : enable
#extension GL_ARB_shader_image_load_store : enable
#extension GL_GOOGLE_include_directive : enable
</span>
<span class="cp">#include "VisibilityCommon.inc"
</span>
<span class="k">layout</span><span class="p">(</span><span class="n">early_fragment_tests</span><span class="p">)</span> <span class="k">in</span><span class="p">;</span>

<span class="k">layout</span> <span class="p">(</span><span class="n">location</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span> <span class="k">in</span> <span class="kt">vec4</span> <span class="n">pos0</span><span class="p">;</span>
<span class="k">layout</span> <span class="p">(</span><span class="n">location</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span> <span class="k">in</span> <span class="kt">vec2</span> <span class="n">uv_in</span><span class="p">;</span>
<span class="k">layout</span> <span class="p">(</span><span class="n">location</span> <span class="o">=</span> <span class="mi">3</span><span class="p">)</span> <span class="k">in</span> <span class="kt">vec4</span> <span class="n">planeEquationBx_in</span><span class="p">;</span>
<span class="k">layout</span> <span class="p">(</span><span class="n">location</span> <span class="o">=</span> <span class="mi">4</span><span class="p">)</span> <span class="k">in</span> <span class="kt">vec4</span> <span class="n">planeEquationBy_in</span><span class="p">;</span>
<span class="k">layout</span> <span class="p">(</span><span class="n">location</span> <span class="o">=</span> <span class="mi">5</span><span class="p">)</span> <span class="k">in</span> <span class="k">flat</span> <span class="kt">uint</span> <span class="n">primitiveId_in</span><span class="p">;</span>
<span class="k">layout</span> <span class="p">(</span><span class="n">location</span> <span class="o">=</span> <span class="mi">6</span><span class="p">)</span> <span class="k">in</span> <span class="k">flat</span> <span class="kt">uint</span> <span class="n">drawId_in</span><span class="p">;</span>

<span class="c1">// Y = I,J bary coords, K can be calculated
</span><span class="k">layout</span> <span class="p">(</span><span class="n">location</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span> <span class="k">out</span> <span class="kt">uvec2</span> <span class="n">id_and_barys</span><span class="p">;</span>
<span class="c1">// X,Y = dFdX, dFdY
</span><span class="k">layout</span> <span class="p">(</span><span class="n">location</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span> <span class="k">out</span> <span class="kt">uvec2</span> <span class="n">derivs</span><span class="p">;</span>
<span class="k">layout</span> <span class="p">(</span><span class="n">location</span> <span class="o">=</span> <span class="mi">2</span><span class="p">)</span> <span class="k">out</span> <span class="kt">vec4</span> <span class="n">debug_out</span><span class="p">;</span>

<span class="k">layout</span><span class="p">(</span><span class="n">origin_upper_left</span><span class="p">)</span> <span class="k">in</span> <span class="kt">vec4</span> <span class="nb">gl_FragCoord</span><span class="p">;</span>

<span class="kt">void</span> <span class="nf">main</span><span class="p">()</span>
<span class="p">{</span>
	<span class="c1">// Reconstruct barycentric coords from screen pos and the plane eqns set up by the GS.
</span>	<span class="k">const</span> <span class="kt">float</span> <span class="n">bx</span> <span class="o">=</span> <span class="o">-</span><span class="p">(</span><span class="n">planeEquationBx_in</span><span class="p">.</span><span class="n">w</span> <span class="o">+</span> <span class="n">planeEquationBx_in</span><span class="p">.</span><span class="n">x</span> <span class="o">*</span> <span class="nb">gl_FragCoord</span><span class="p">.</span><span class="n">x</span> <span class="o">+</span> <span class="n">planeEquationBx_in</span><span class="p">.</span><span class="n">y</span> <span class="o">*</span> <span class="nb">gl_FragCoord</span><span class="p">.</span><span class="n">y</span><span class="p">)</span> <span class="o">/</span> <span class="n">planeEquationBx_in</span><span class="p">.</span><span class="n">z</span><span class="p">;</span>
	<span class="k">const</span> <span class="kt">float</span> <span class="n">by</span> <span class="o">=</span> <span class="o">-</span><span class="p">(</span><span class="n">planeEquationBy_in</span><span class="p">.</span><span class="n">w</span> <span class="o">+</span> <span class="n">planeEquationBy_in</span><span class="p">.</span><span class="n">x</span> <span class="o">*</span> <span class="nb">gl_FragCoord</span><span class="p">.</span><span class="n">x</span> <span class="o">+</span> <span class="n">planeEquationBy_in</span><span class="p">.</span><span class="n">y</span> <span class="o">*</span> <span class="nb">gl_FragCoord</span><span class="p">.</span><span class="n">y</span><span class="p">)</span> <span class="o">/</span> <span class="n">planeEquationBy_in</span><span class="p">.</span><span class="n">z</span><span class="p">;</span>
	<span class="k">const</span> <span class="kt">vec3</span> <span class="n">barycentrics</span> <span class="o">=</span> <span class="kt">vec3</span><span class="p">(</span><span class="n">bx</span><span class="p">,</span> <span class="n">by</span><span class="p">,</span> <span class="mi">1</span> <span class="o">-</span> <span class="p">(</span><span class="n">bx</span> <span class="o">+</span> <span class="n">by</span><span class="p">));</span> <span class="c1">// Reconstruct 3rd barycentric from the other 2.
</span>	<span class="n">debug_out</span> <span class="o">=</span> <span class="kt">vec4</span><span class="p">(</span><span class="n">barycentrics</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>

	<span class="n">id_and_barys</span><span class="p">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">calculateVisibilityId</span><span class="p">(</span><span class="nb">true</span><span class="p">,</span> <span class="n">drawId_in</span><span class="p">,</span> <span class="n">primitiveId_in</span><span class="p">);</span>
	<span class="n">id_and_barys</span><span class="p">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">packUnorm2x16</span><span class="p">(</span><span class="n">debug_out</span><span class="p">.</span><span class="n">xy</span><span class="p">);</span>

	<span class="n">derivs</span><span class="p">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">packSnorm2x16</span><span class="p">(</span><span class="n">dFdx</span><span class="p">(</span><span class="n">uv_in</span><span class="p">));</span>
	<span class="n">derivs</span><span class="p">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">packSnorm2x16</span><span class="p">(</span><span class="n">dFdy</span><span class="p">(</span><span class="n">uv_in</span><span class="p">));</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Non Pygments code example</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;div id="awesome"&gt;
    &lt;p&gt;This is great isn't it?&lt;/p&gt;
&lt;/div&gt;
</code></pre></div></div>

<h2 id="thanks">Thanks!</h2>

<p>Alex Dunn
Tomasz Stachowiak</p>

<h2 id="references">References</h2>

<div class="footnotes">
  <ol>
    <li id="fn:1">
      <p><a href="http://jcgt.org/published/0002/02/04/">http://jcgt.org/published/0002/02/04/</a>Blah&nbsp;<a href="#fnref:1" class="reversefootnote">&#8617;</a></p>
    </li>
    <li id="fn:2">
      <p><a href="https://h3r2tic.github.io/">https://h3r2tic.github.io/</a>&nbsp;<a href="#fnref:2" class="reversefootnote">&#8617;</a></p>
    </li>
  </ol>
</div>

      <footer class="entry-meta">
        <span class="entry-tags"><a href="http://localhost:4000/tags/#barycentric" title="Pages tagged barycentric" class="tag"><span class="term">barycentric</span></a><a href="http://localhost:4000/tags/#amd" title="Pages tagged amd" class="tag"><span class="term">amd</span></a><a href="http://localhost:4000/tags/#nvidia" title="Pages tagged nvidia" class="tag"><span class="term">nvidia</span></a><a href="http://localhost:4000/tags/#fastgs" title="Pages tagged fastgs" class="tag"><span class="term">fastgs</span></a><a href="http://localhost:4000/tags/#vbuffer" title="Pages tagged vbuffer" class="tag"><span class="term">vbuffer</span></a><a href="http://localhost:4000/tags/#visibility buffer" title="Pages tagged visibility buffer" class="tag"><span class="term">visibility buffer</span></a><a href="http://localhost:4000/tags/#gpu" title="Pages tagged gpu" class="tag"><span class="term">gpu</span></a><a href="http://localhost:4000/tags/#hlsl" title="Pages tagged hlsl" class="tag"><span class="term">hlsl</span></a><a href="http://localhost:4000/tags/#spirv" title="Pages tagged spirv" class="tag"><span class="term">spirv</span></a><a href="http://localhost:4000/tags/#post" title="Pages tagged post" class="tag"><span class="term">post</span></a></span>
        <span>Updated on <span class="entry-date date updated"><time datetime="2017-11-26">November 26, 2017</time></span></span>
        <span class="author vcard"><span class="fn">Graham Wihlidal</span></span>
        <div class="social-share">
  <ul class="socialcount socialcount-small inline-list">
    <li class="facebook"><a href="https://www.facebook.com/sharer/sharer.php?u=http://localhost:4000/storing-barycentrics/" title="Share on Facebook"><span class="count"><i class="fa fa-facebook-square"></i> Like</span></a></li>
    <li class="twitter"><a href="https://twitter.com/intent/tweet?text=http://localhost:4000/storing-barycentrics/" title="Share on Twitter"><span class="count"><i class="fa fa-twitter-square"></i> Tweet</span></a></li>
    <li class="googleplus"><a href="https://plus.google.com/share?url=http://localhost:4000/storing-barycentrics/" title="Share on Google Plus"><span class="count"><i class="fa fa-google-plus-square"></i> +1</span></a></li>
  </ul>
</div><!-- /.social-share -->
      </footer>
    </div><!-- /.entry-content -->
    <section id="disqus_thread"></section><!-- /#disqus_thread -->
    <div class="read-more">
  
    <div class="read-more-header">
      <a href="http://localhost:4000/background-image/" class="read-more-btn">Read More</a>
    </div><!-- /.read-more-header -->
    <div class="read-more-content">
      <h3><a href="http://localhost:4000/background-image/" title="Post with a Background Image">Post with a Background Image</a></h3>
      <p>Sample post with a background image CSS override. <a href="http://localhost:4000/background-image/">Continue reading</a></p>
    </div><!-- /.read-more-content -->
  
  <div class="read-more-list">
    
      <div class="list-item">
        <h4><a href="http://localhost:4000/code-highlighting-post/" title="Syntax Highlighting Post">Syntax Highlighting Post</a></h4>
        <span>Published on August 16, 2013</span>
      </div><!-- /.list-item -->
    
      <div class="list-item">
        <h4><a href="http://localhost:4000/sample-link-post/" title="Sample Link Post">Sample Link Post</a></h4>
        <span>Published on August 12, 2013</span>
      </div><!-- /.list-item -->
    
  </div><!-- /.read-more-list -->
</div><!-- /.read-more -->
  </article>
</div><!-- /#main -->

<div class="footer-wrapper">
  <footer role="contentinfo">
    <span>&copy; 2017 Graham Wihlidal. Powered by <a href="http://jekyllrb.com" rel="nofollow">Jekyll</a> using the <a href="https://mademistakes.com/work/hpstr-jekyll-theme/" rel="nofollow">HPSTR Theme</a>.</span>
  </footer>
</div><!-- /.footer-wrapper -->

<script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
<script>window.jQuery || document.write('<script src="http://localhost:4000/assets/js/vendor/jquery-1.9.1.min.js"><\/script>')</script>
<script src="http://localhost:4000/assets/js/scripts.min.js"></script>


<!-- Asynchronous Google Analytics snippet -->
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-110210650-1', 'auto');  
  ga('require', 'linkid', 'linkid.js');
  ga('send', 'pageview');
</script>



    <script type="text/javascript">
        /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
        var disqus_shortname = '';

        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();

        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function () {
            var s = document.createElement('script'); s.async = true;
            s.type = 'text/javascript';
            s.src = '//' + disqus_shortname + '.disqus.com/count.js';
            (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
        }());
    </script>
    <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
	        

</body>
</html>
